# k-)-ssh-rest-client
Внешняя компонента 1С:Предприятие, которая позволяет отправлять http-запросы на удаленный сервер внутри туннеля SSH, в том числе, опубликованных с использованием unix сокетов, а также выполнять команды shell на удаленном сервере.

## Примеры использования

__Управление Podman__
```go
// Подключаем внешнюю компоненту
// ПодключитьВнешнююКомпоненту(("ИмяМакета", "MyComp", ТипВнешнейКомпоненты.Native);)
ПодключитьВнешнююКомпоненту("/ПутьКБиблиотеке/libSshRestClient.so", "MyComp", ТипВнешнейКомпоненты.Native);
ОбъектКомпоненты = Новый ("AddIn.MyComp.AddInNativeExtension"); 

// Подключаемся к серверу

// Указываем, параметры подключения к podman
ОбъектКомпоненты.УдаленныйХост = "run/user/1000/podman/podman.sock";
ОбъектКомпоненты.UnixСокет = Истина;
ОбъектКомпоненты.ИспользоватьПересылку = Истина;

// Подключаемся к удаленному серверу
IPАдресСервера = "127.0.0.1";
Порт = 22;
ИмяПользователя = Неопределено; // Имя пользователя для аутентификации по ключу. Если неопределено - текущий логин
ОбъектКомпоненты.ОткрытьСессию(IPАдресСервера, Порт, ИмяПользователя);

// Проверяем публичный ключ сервера (должен быть в доверенных хостах). Не разрешаем импорт или обновление публичного ключа сервера
// если он не найден в доверенных хостах
Результат = ОбъектКомпоненты.ПроверитьСервер(Ложь, Ложь);  

// Возвращаемое значение:
// SSH_KNOWN_HOSTS_OK - сервер есть в доверенных
// SSH_KNOWN_HOSTS_UNKNOWN - сервер не найден в доверенных
// SSH_KNOWN_HOSTS_CHANGED - ключ сервера не совпвдает с ключем в доверенных
// SSH_KNOWN_HOSTS_OTHER - есть другой ключ
Если Результат <> "SSH_KNOWN_HOSTS_OK" Тогда
    // Ключа сервера нет или он не соответствует
КонецЕсли;

// Проходим проверку подлинности
// Логин/Пароль
//ОбъектКомпоненты.АутентифицироватьсяПоПаролю("ИмяПользователя", "Пароль");

// По файлу ключа
// ПутьКФайлуКлюча = "ПутьКФайлуКлюча";
//ОбъектКомпоненты.АутентифицироватьсяПоКлючу(ПутьКФайлуКлюча);

// Ключ как двоичные данные
Ключ = Новый ДвоичныеДанные("ПутьКФайлуКлюча");
ОбъектКомпоненты.АутентифицироватьсяПоКлючуBase64(Ключ);

// Выполняем запрос
ОбъектКомпоненты.УстановитьЗаголовокHttpЗапроса("GET", "/v4.0.0/libpod/info");
ОбъектКомпоненты.ДобавитьHttpЗаголовок("Host", "d"); 
ОбъектКомпоненты.УстановитьТелоИзДвоичныхДанных(Неопределено);
Результат = ОбъектКомпоненты.ОтправитьHttpЗапрос();
Данные = ОбъектКомпоненты.ПолучитьТелоКакДвоичныеДанные();  
ТелоСтрока = ПолучитьСтрокуИзДвоичныхДанных(Данные);
```

__Выполнение команд shell__
```go
// Подключаем внешнюю компоненту
// ПодключитьВнешнююКомпоненту(("ИмяМакета", "MyComp", ТипВнешнейКомпоненты.Native);)
ПодключитьВнешнююКомпоненту("/ПутьКБиблиотеке/libSshRestClient.so", "MyComp", ТипВнешнейКомпоненты.Native);
ОбъектКомпоненты = Новый ("AddIn.MyComp.AddInNativeExtension"); 

// Подключаемся к серверу
IPАдресСервера = "127.0.0.1";
Порт = 22;
ОбъектКомпоненты.ОткрытьСессию(IPАдресСервера, Порт);

// Проверяем публичный ключ сервера (должен быть в доверенных хостах). Не разрешаем импорт или обновление публичного ключа сервера
// если он не найден в доверенных хостах
Результат = ОбъектКомпоненты.ПроверитьСервер(Ложь, Ложь);  

// Возвращаемое значение:
// SSH_KNOWN_HOSTS_OK - сервер есть в доверенных
// SSH_KNOWN_HOSTS_UNKNOWN - сервер не найден в доверенных
// SSH_KNOWN_HOSTS_CHANGED - ключ сервера не совпвдает с ключем в доверенных
// SSH_KNOWN_HOSTS_OTHER - есть другой ключ
Если Результат <> "SSH_KNOWN_HOSTS_OK" Тогда
    // Ключа сервера нет или он не соответствует
КонецЕсли;

// Проходим проверку подлинности
// Логин/Пароль
//ОбъектКомпоненты.АутентифицироватьсяПоПаролю("ИмяПользователя", "Пароль");

// По файлу ключа
// ПутьКФайлуКлюча = "ПутьКФайлуКлюча";
//ОбъектКомпоненты.АутентифицироватьсяПоКлючу(ПутьКФайлуКлюча);

// Ключ как двоичные данные
Ключ = Новый ДвоичныеДанные("ПутьКФайлуКлюча");
ОбъектКомпоненты.АутентифицироватьсяПоКлючуBase64(Ключ);

// Создаем файл ~/test.txt с содержимым Hello World
Данные = ПолучитьДвоичныеДанныеИзСтроки("Hello world!");
ОбъектКомпоненты.УстановитьЗапросИзДвоичныхДанных(Данные);
ОбъектКомпоненты.ВыполнитьКоманду("cat > ~/test.txt");

// Получаем список файлов в текущей папке
// Не передаем данные в команду, поэтому устанавливаем запрос в Неопределено 
ОбъектКомпоненты.УстановитьЗапросИзДвоичныхДанных(Неопределено);
ОбъектКомпоненты.ВыполнитьКоманду("ls");       
Данные = ОбъектКомпоненты.ПолучитьОтветКакДвоичныеДанные();
ТелоСтрока = ПолучитьСтрокуИзДвоичныхДанных(Данные);
// ТелоСтрока содержит список файлов
```

